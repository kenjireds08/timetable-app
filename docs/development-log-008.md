# Development Log 008: 教師管理UI改善 - 確定/NG/希望/詳細の4区分統一

## 日付
2025-08-26

## 概要
教師管理UIを「確定/NG/希望/詳細」の4区分で統一し、来年以降のGoogleフォーム運用を見据えた改善を実施。

## 背景と経緯

### 問題発生（17:30）
- AdvancedTeacherManagerV2への変更でUIが完全に崩壊
- デザイン・レイアウトが大きく崩れ、機能しない状態に

### ChatGPTのアドバイス
- `/clear`より「コードロールバック → 最小変更で積み直し」を推奨
- 段階的な復旧と改善の方針を提案

## 実施内容

### 1. UI崩壊からの復旧（17:30-18:00）

#### 復旧手順
1. プロジェクト全体のバックアップ作成
   - `timetable-app-backup-20250826-173551.tar.gz`として保存
2. 問題ファイルの削除
   - `AdvancedTeacherManagerV2.tsx`
   - `teacher.ts`
   - `loadTeachers.ts`
   - `teachers.json`
   - `mondayMakeupCalculator.ts`
3. App.tsxを元の状態に復元
4. 開発サーバー再起動・型チェック実行

**結果：元のUIに完全復旧成功**

### 2. 教師制約データのJSON化（18:00-19:00）

#### 作成ファイル
`/public/config/teachers_constraints_2025H2.json`

#### データ構造
```json
{
  "version": "2025-H2",
  "schema": "teacher-constraints/v1",
  "teachers": [
    {
      "id": "teacher_id",
      "name": "教師名",
      "confirmed": ["確定事項..."],
      "ng": {
        "days": ["曜日"],
        "periods": [時限],
        "dates": ["特定日"],
        "notes": "補足"
      },
      "wish": {
        "preferDays": ["希望曜日"],
        "preferConsecutive": true,
        "preferPackedDay": true,
        "biweekly": "odd|even",
        "notes": "希望補足"
      },
      "subjects": ["担当科目"],
      "notes": "備考"
    }
  ]
}
```

#### 全21名の教師データを整理
- Excelファイル「後期要望まとめ.xlsx」から全教師の要望を抽出
- 確定/NG/希望の3区分に分類
- 統一フォーマットドキュメント作成（`teachers_formatted_2025H2.md`）

### 3. UI実装（19:00-21:00）

#### 表示改善
1. **4区分の常時表示**
   - 確定（緑）/ NG（赤）/ 希望（青）/ 詳細（グレー）
   - 未入力でも「— 未入力」として表示
   - すべての教師で統一された表示形式

2. **カラーコーディング**
   ```css
   .confirmed-tag { background: #dcfce7; color: #065f46; }
   .ng-tag { background: #fee2e2; color: #7f1d1d; }
   .wish-tag { background: #dbeafe; color: #1e3a8a; }
   .category-empty { color: #9ca3af; font-style: italic; }
   ```

3. **詳細セクション追加**
   - 担当科目の表示
   - 補足説明の表示
   - 💡アイコンで視覚的に区別

### 4. 編集機能の改修（21:00-22:00）

#### 編集・追加フォームの新フォーマット対応
1. **確定事項セクション**
   - 改行区切りのテキストエリア
   - 複数の確定条件を入力可能

2. **NGセクション**
   - 曜日チェックボックス（月〜金）
   - 時限チェックボックス（1〜4限）
   - 日付入力（YYYY-MM-DD形式）
   - 備考入力欄

3. **希望セクション**
   - 希望曜日チェックボックス
   - オプション（連続コマ希望、1日集約希望）
   - 隔週設定（奇数週/偶数週）
   - 希望備考

4. **詳細セクション**
   - 担当科目・補足説明のテキストエリア

#### データ保存機能
- LocalStorageを使用した永続化
- JSONデータとの同期処理
- 新規追加・編集時の自動保存

## 技術的な改善点

### アーキテクチャの決定
1. **Single Source of Truth (SSOT)**
   - `teachers_constraints_2025H2.json`を真実の源とする
   - UIはJSONデータを読み込んで表示

2. **段階的な実装アプローチ**
   - 大規模変更を避け、最小限の変更で機能追加
   - 既存UIを崩さないよう慎重に実装

3. **シンプルな状態管理**
   - React Hooksのみで実装
   - 複雑なライブラリは使用せず

## 成果

### Before
- 制約情報が散在し、一覧性が低い
- 編集画面が旧フォーマット
- 未入力項目が見えない

### After
- 4区分で統一された見やすいUI
- すべての教師の制約が一目で確認可能
- 未入力項目も「— 未入力」として可視化
- 編集・追加画面も新フォーマットに統一

## 学習事項

1. **UI変更は段階的に**
   - 大規模な変更は予期せぬ崩壊を招く
   - バックアップを取ってから実施
   - 小さな変更を積み重ねる

2. **データ構造の重要性**
   - 明確な区分（確定/NG/希望）で整理
   - JSONによる構造化でメンテナンス性向上
   - 将来の拡張（Googleフォーム連携）を考慮

3. **視覚的な情報整理**
   - カラーコーディングによる直感的な理解
   - アイコンによる視覚的な区別
   - 統一されたレイアウトで一覧性向上

## 次のステップ

1. **データ検証**
   - [ ] 教師の要望と登録内容の照合
   - [ ] 漏れや不整合の確認
   - [ ] 必要に応じた修正

2. **機能拡張（必要に応じて）**
   - [ ] 必須チェックと警告UI
   - [ ] 整合性チェック機能
   - [ ] CSVエクスポート機能

3. **実運用準備**
   - [ ] Googleフォームのテンプレート作成
   - [ ] データインポート機能の実装
   - [ ] バリデーションルールの強化

## 参考資料
- 後期要望まとめ.xlsx
- ChatGPTによる改善提案
- teachers_formatted_2025H2.md（統一フォーマット）

---
*作業時間: 17:30-22:00（4時間30分）*