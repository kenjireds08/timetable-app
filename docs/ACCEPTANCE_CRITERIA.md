# 受け入れ基準（Acceptance Criteria）

## 0. 入力データソース基準【2025/08/22 クライアント確認済み】

### データソース
- **基準シート**: 「サマリ」シートを使用（ITS202503シートではない）
- **対象科目**: サマリシートに記載の科目のみ
- **時間割挿入不要科目**:
  - インターンシップⅠ/Ⅱ
  - 長陽祭プロジェクト実践Ⅰ/Ⅱ
  - 海外研修Ⅰ/Ⅱ
  （※学生の実績により成績を付与する科目のため、時間割への事前挿入は不要）
- **Webデザイン（ノーコード）**: 
  - ITソリューション学科：選択科目
  - 地域観光デザイン学科：専門科目（時間割挿入必要）

## 1. フィオーナ先生補填機能

### 機能要件
- [ ] 木曜3限の15分遅れ × 実施回数 = 不足分を自動算出
- [ ] 月曜3限×2 + 月曜4限×1（合計240分）を自動候補提示
- [ ] 12/22（やまめ）を自動除外
- [ ] 成果発表会（1/26-28）を自動除外
- [ ] 補講期間（1/29-2/6）を自動除外
- [ ] 承認前プレビュー機能
- [ ] 承認後の反映機能
- [ ] 元に戻す（Undo）機能

### 計算ロジック
```
不足分（分） = 木曜3限実施回数 × 15分
補填必要コマ数 = 3コマ（3限×2 + 4限×1）
```

### エッジケース
- 木曜3限が行事でキャンセル → その週の15分は加算しない
- 月曜で240分確保できない場合 → 「不足分○分」アラート表示のみ

## 2. ブロック週機能

### 機能要件
- [ ] `blockedWeeks`と`holidays`の両方を反映
- [ ] ドラッグ&ドロップでブロック週への配置を禁止
- [ ] 自動生成でブロック週を自動除外
- [ ] 週ヘッダに行事名バッジ表示
- [ ] 該当セルのグレーアウト表示
- [ ] ドロップ不可の視覚的フィードバック
- [ ] Excel出力でブロック表示（薄灰色セル or 備考欄）
- [ ] PDF出力でブロック表示

### ブロック対象
1. **12/22（月）**: やまめ
2. **1/26（月）-1/28（水）**: 成果発表会
3. **1/29（木）-2/6（金）**: 補講期間

## 3. エラーUI改善

### トースト通知
- [ ] 配置失敗時に右上5秒表示
- [ ] 日本語メッセージ表示
- [ ] 失敗理由の明確化

### エラーメッセージ文言
```
- 行事ブロック：成果発表会につき配置不可（1/26-28）
- 教師重複：{teacher}が同時刻に別授業
- 教室使用中：{classroom}は{subject}で使用中
- 不足分補填：月曜3限×2 + 4限×1を提案しました
```

### セル表示
- [ ] 🎌 休日
- [ ] ⚠️ 行事ブロック
- [ ] 🚫 使用中
- [ ] ツールチップで詳細表示

## 4. 科目名正規化

### 変換ルール
- [ ] Ⅰ ⇔ I
- [ ] Ⅱ ⇔ II
- [ ] Ⅲ ⇔ III
- [ ] 末尾タグ[共通][合同][コンビ]は保持

### 適用箇所
- [ ] データ投入時（SubjectManager）
- [ ] 進捗表示
- [ ] 一致判定

## 5. 設定の外部化

### JSON設定ファイル
- [ ] `/public/config/school-config.json`作成
- [ ] 学期期間設定
- [ ] 休日リスト
- [ ] ブロック週リスト
- [ ] 特殊制約設定

### 環境変数
- [ ] `VITE_SCHOOL_CONFIG_URL`追加
- [ ] 本番/検証環境の切り替え

## 6. テスト要件

### 単体テスト
- [ ] `isBlocked(date, blockedWeeks): boolean`
- [ ] `calcFionaShortage(thursday3Count): minutes`
- [ ] `suggestFionaMakeupSlots(...): MakeupSuggestion[]`
- [ ] `normalizeSubjectName(name): string`

### 統合テスト
- [ ] フィオーナ補填フロー全体
- [ ] ブロック週のドラッグ&ドロップ
- [ ] Export機能（Excel/PDF）

## 7. 可観測性

### ログ出力
```javascript
log.info('BLOCKED_WEEK_HIT', { date, blockId })
log.info('FIONA_SHORTAGE', { thursday3Count, shortageMin })
log.warn('MAKEUP_NOT_FOUND', { needed: 240, found: 150 })
```

## 8. リリース管理

### フィーチャーフラグ
- [ ] `enableFionaMakeup`
- [ ] `enableBlockedWeeks`
- [ ] `enableSubjectNormalization`
- [ ] `enableImprovedErrorUI`

### バージョン管理
- [ ] Export出力にバージョン印字
- [ ] `Generated by timetable-app vX.Y (config: date)`

---

## チェックポイント（クライアント確認事項）

### データソース
- [ ] サマリ vs ITS202503の対象基準確定
- [ ] 選択科目の扱い確定
- [ ] 「Webデザイン（ノーコード）」の扱い

### 期間・日程
- [ ] 後期終了日の確定（1/23まで？）
- [ ] 実授業最終週の確定
- [ ] 追加の祝日・行事の有無

### フィオーナ先生ルール
- [ ] 木曜3限キャンセル時の不足分計上方針
- [ ] 月曜補填で不足時の対応方針

---

**最終更新**: 2025年8月21日
**ステータス**: クライアント返信待ち