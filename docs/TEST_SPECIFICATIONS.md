# テスト仕様書

## 1. 関数仕様（純関数）

### 1.1 日付ブロック判定
```typescript
function isBlocked(
  date: string,
  blockedWeeks: WeekBlock[]
): boolean
```

**テストケース**:
| date | blockedWeeks | 期待値 | 説明 |
|------|--------------|--------|------|
| 2026-01-27 | [1/26-1/28] | true | 期間内 |
| 2026-01-26 | [1/26-1/28] | true | 開始日境界 |
| 2026-01-28 | [1/26-1/28] | true | 終了日境界 |
| 2026-01-25 | [1/26-1/28] | false | 期間前 |
| 2026-01-29 | [1/26-1/28] | false | 期間後 |

### 1.2 フィオーナ不足分計算
```typescript
function calcFionaShortage(
  thursday3Count: number
): number  // 分単位
```

**テストケース**:
| thursday3Count | 期待値(分) | 説明 |
|---------------|-----------|------|
| 0 | 0 | 授業なし |
| 8 | 120 | 半期中間 |
| 16 | 240 | 通常想定 |
| 20 | 300 | 上限超過 |

### 1.3 フィオーナ補填候補提案
```typescript
interface MakeupSuggestion {
  date: string;
  period: '3限' | '4限';
  minutes: number;
  priority: number;
}

function suggestFionaMakeupSlots(
  args: {
    startDate: string;
    endDate: string;
    holidays: string[];
    blockedWeeks: WeekBlock[];
    usedSlots: Set<string>;
    requiredMinutes: number;
  }
): MakeupSuggestion[]
```

**テストケース**:
| シナリオ | requiredMinutes | 期待結果 |
|---------|----------------|----------|
| 通常 | 240 | 3件（3限×2、4限×1） |
| 月曜不足 | 240 | 候補数 < 3 |
| 月曜なし | 240 | [] |
| 部分補填 | 150 | 2件（3限×2） |

### 1.4 科目名正規化
```typescript
function normalizeSubjectName(
  name: string
): string
```

**テストケース**:
| 入力 | 期待出力 | 説明 |
|------|---------|------|
| プログラミングⅠ | プログラミングI | 全角→半角 |
| データベースII | データベースII | 変更なし |
| 英語Ⅲ[共通] | 英語III[共通] | タグ保持 |
| WebデザインⅠ/Ⅱ | WebデザインI/II | 複数変換 |

## 2. 統合テスト仕様

### 2.1 フィオーナ補填フロー
```gherkin
Feature: フィオーナ先生の月曜補填
  
  Scenario: 通常の補填フロー
    Given 木曜3限が16回実施された
    When 補填計算を実行
    Then 不足分240分が算出される
    And 月曜3限×2、4限×1の候補が提案される
    
  Scenario: 12/22除外
    Given 月曜候補日に12/22が含まれる
    When 補填候補を生成
    Then 12/22は候補から除外される
```

### 2.2 ブロック週のドラッグ&ドロップ
```gherkin
Feature: ブロック週への配置禁止
  
  Scenario: 成果発表会週へのドロップ
    Given 1/26-1/28が成果発表会
    When 1/27に授業をドロップ
    Then 配置が拒否される
    And "行事ブロック"エラーが表示される
```

## 3. パフォーマンステスト

### 3.1 大規模データ
- 教師: 50名
- 科目: 100科目
- 教室: 20室
- 期間: 19週

**計測項目**:
- 自動生成時間: < 3秒
- ドラッグ&ドロップ応答: < 100ms
- Export処理: < 5秒

### 3.2 メモリ使用量
- 初期読み込み: < 50MB
- 19週表示時: < 100MB
- Export時ピーク: < 200MB

## 4. エッジケーステスト

### 4.1 境界値
- 週数0
- 週数100
- 教師0名
- 科目0
- 全休日

### 4.2 異常系
- 不正な日付形式
- null/undefined
- 循環参照
- 重複ID

## 5. UI/UXテスト

### 5.1 ドラッグ&ドロップ
- [ ] ドラッグ開始時のビジュアルフィードバック
- [ ] ドロップ可能領域のハイライト
- [ ] ドロップ不可領域の視覚的区別
- [ ] ESCキーでキャンセル

### 5.2 エラー表示
- [ ] トースト通知が5秒表示
- [ ] 複数エラーの同時表示
- [ ] エラーメッセージの日本語表示
- [ ] 詳細情報へのリンク

### 5.3 レスポンシブ
- [ ] 1920×1080（フルHD）
- [ ] 1366×768（ノートPC）
- [ ] タブレット横向き
- [ ] 印刷プレビュー

## 6. セキュリティテスト

### 6.1 入力検証
- [ ] XSS対策（<script>タグ）
- [ ] SQLインジェクション（該当なし）
- [ ] 文字数上限（科目名255文字）
- [ ] 特殊文字エスケープ

### 6.2 データ保護
- [ ] localStorage暗号化不要（機密情報なし）
- [ ] Export時の個人情報マスク不要
- [ ] 通信なし（ローカル完結）

## 7. 回帰テスト

### 7.1 既存機能の保護
- [ ] 3段階スケジューリング
- [ ] ドラッグ&ドロップ
- [ ] Excel/PDF出力
- [ ] 進捗表示
- [ ] タブ切り替え

### 7.2 後方互換性
- [ ] 既存データの読み込み
- [ ] 旧形式のExport
- [ ] ブラウザ互換性（Chrome, Firefox, Safari, Edge）

---

**最終更新**: 2025年8月21日
**ステータス**: 関数名合意待ち